This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
pages/
  __init__.py
  base_page.py
  login_page.py
tests/
  __init__.py
  conftest.py
  test_auth.py
utils/
  api_client.py
.gitattributes
.gitignore
pytest.ini
readme.md
requirements.txt
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="pages/__init__.py">

</file>

<file path="tests/__init__.py">

</file>

<file path=".gitattributes">

</file>

<file path=".gitignore">
# --- [Python & Environment] ---
.venv/
venv/
ENV/
env/
__pycache__/
*.py[cod]
*$py.class
.env
.pytest_cache/
*.egg-info/
dist/
build/
repomix_packaging/

# --- [Playwright & Test Reports] ---
test-results/
playwright-report/
blob-report/
playwright/.local-browsers/
storage_state.json

# --- [스크린샷 수집 (테스트 실패 시 자동 생성)] ---
datasets/raw_screenshots/

# --- [YOLO 관련 (나중에 필요)] ---
# 지금은 생성되지 않지만 미리 제외 설정
runs/
*.pt
*.onnx
datasets/labeled/
datasets/augmented/

# --- [IDEs & OS] ---
.vscode/
.idea/
*.swp
*.swo
.DS_Store
Thumbs.db

# --- [Logs] ---
*.log
npm-debug.log*
</file>

<file path="pytest.ini">
# pytest.ini
[pytest]
# 테스트 탐색을 시작할 기본 경로 설정
testpaths = tests
norecursedirs = .venv .git AppData Local Microsoft Windows
# 파이썬 경로에 현재 루트 폴더 추가
pythonpath = .
</file>

<file path="requirements.txt">
playwright==1.58.0
pytest==8.0.0
pytest-playwright==0.7.2
python-dotenv==1.0.1  # 환경 변수 관리용
</file>

<file path="tests/conftest.py">
import pytest
from dotenv import load_dotenv

load_dotenv()
@pytest.fixture(scope="session")
def browser_fix(browser_context_args):
    """
    Playwright의 기본 브라우저 컨텍스트 설정을 오버라이드합니다.
    모든 테스트는 이 설정을 공통으로 상속받습니다.
    """
    return {
        **browser_context_args,
        # Task 1.2: AI 인식률 최적화를 위한 1280x720 고정 해상도
        "viewport": {
            "width": 1280,
            "height": 720,
        },
        # 고정 스케일 팩토리: OS별 고해상도 모니터(Retina 등)로 인한 픽셀 배수 차이 방지
        "device_scale_factor": 1,
        # 유저 에이전트 표준화: 브라우저 지문 차이로 인한 UI 변경 방지
        "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    }
</file>

<file path="utils/api_client.py">
import requests
import os

API_URL = os.getenv("API_URL")

def get_auth_data(email: str, password: str) -> dict:
    """API로 로그인하여 토큰 딕셔너리(access, refresh 등)를 반환합니다."""
    res = requests.post(
        f"{API_URL}/api/v1/auth/login",
        json={"email": email, "password": password},
        timeout=60
    )
    res.raise_for_status() # 에러 발생 시 즉시 중단
    return res.json()
</file>

<file path="readme.md">
윈도우
.\venv\Scripts\Activate.ps1
맥
source .venv/bin/activate
가상환경 활성화

repomix .
repomix . -o repomix_packaging\repomix-output.xml
llm 패키징

python -m pytest tests/test_auth.py --headed --slowmo 500

develop 브랜치로 이동 및 최신화
git checkout develop
git pull origin develop

기능 브랜치 생성 (예: feature/tc4-payment)
git checkout -b feature/[기능명]

코드 작업 후 커밋
git add .
git commit -m "Add [기능명] test case"

완료 후 develop에 합치기 (Recursive Merge)
git checkout develop
git merge --no-ff feature/[기능명] -m "Merge [기능명] into develop"

원격 저장소 업로드 및 브랜치 삭제
git push origin develop
git branch -d feature/[기능명]
릴리즈 브랜치 생성 (버전은 v1.2.0 등으로 올림)
git checkout develop
git checkout -b release/[버전명]

(선택) readme.md 수정 등 최종 점검 후 커밋
git add .
git commit -m "Update version [버전명]"

main 브랜치에 합치고 태그 달기
git checkout main
git merge --no-ff release/[버전명] -m "Release [버전명]: 배포 요약"
git tag -a [버전명] -m "Release version [버전명]"

수정사항을 다시 develop에도 반영
git checkout develop
git merge --no-ff release/[버전명]

최종 푸시 및 브랜치 삭제
git push origin main --tags
git push origin develop
git branch -d release/[버전명]

명령어 옵션: merge 할 때 --no-ff를 꼭 붙여주세요. 그래야 나중에 어떤 기능이 추가되었는지 히스토리가 선명하게 남습니다

맥 환경설정
pip install -r requirements.txt
playwright install

변경된 요구사항에 맞춰 패키지 버전 업데이트
pip install -r requirements.txt

새로운 Playwright 버전에 맞는 구동 브라우저 새로 다운로드 (가장 중요!)
playwright install
</file>

<file path="tests/test_auth.py">
from pages.login_page import LoginPage
from playwright.sync_api import expect
import os

admin_email = os.getenv("ADMIN_EMAIL")
admin_pass = os.getenv("ADMIN_PASS")
def test_successful_login(page): #TC1 로그인 성공 테스트
    # 1. 페이지 객체 초기화
    login_page = LoginPage(page)
    # 2. 동작 수행 
    login_page.login_to_system(admin_email, admin_pass)
    # 3. 결과 검증
    assert "/dashboard" in page.url

def test_failed_login(page): #TC2 로그인 실패 테스트
    # 1. 페이지 객체 초기화
    login_page = LoginPage(page)
    # 2. 동작 수행 
    login_page.login_to_system(admin_email, "wrongpassword")
    # 3. 결과 검증
    wait_for_error = page.wait_for_selector("span.error-code strong", state="visible")
    assert wait_for_error is not None

def test_api_login(page):# TC3 API로그인 테스트
    # 1. 페이지 객체 초기화
    login_page = LoginPage(page)
    # 2. 동작 수행
    login_page.api_login(admin_email, admin_pass)
    # 3. 결과 검증
    expect(page.get_by_role("main").get_by_text("Dash board")).to_be_visible()
</file>

<file path="pages/login_page.py">
# pages/login_page.py
from .base_page import BasePage


class LoginPage(BasePage):
    def __init__(self, page, request_context=None):
        super().__init__(page, request_context)
        # Selectors 
        self.email_fld = "//input[@aria-label='이메일' or @type='email']"
        self.password_fld = "//input[@type='password' or @aria-label='비밀번호']"
        self.login_btn = "//button[@type='submit' and @style=('font-size: 20px;')]"

    def login_to_system(self, email, password):
        """기존 UI 로그인 액션 플로우"""
        self.navigate()
        self.do_fill(self.email_fld, email)
        self.do_fill(self.password_fld, password)
        self.do_click(self.login_btn)


    def api_login(self, email, password):
        self.do_api_login(email, password)
        self.navigate("#/dashboard")
</file>

<file path="pages/base_page.py">
from playwright.sync_api import Page
import os
from utils.api_client import get_auth_data
import json

class BasePage:
    def __init__(self, page: Page, request_context=None):
        self.page = page
        self.request = request_context
        self.base_url = os.getenv("BASE_URL")
        
    def navigate(self, path: str = ""):
        """페이지 이동"""
        self.page.goto(f"{self.base_url}{path}")
        
    def do_click(self, selector: str, timeout: int = 5000):
        self.page.wait_for_selector(selector, state="visible", timeout=timeout)
        self.page.click(selector)

    def do_fill(self, selector: str, value: str, timeout: int = 5000):
        """공통 입력 메서드"""
        self.page.wait_for_selector(selector, state="visible", timeout=timeout)
        self.page.fill(selector, value)

    def do_api_login(self, email, password):
        """API 토큰을 발급받아 로컬 스토리지에 주입하고 대시보드로 직행합니다."""
        # 1. API로 토큰 가져오기
        auth_data = get_auth_data(email, password)
        
        # 2. 프론트엔드가 요구하는 user 객체 문자열 생성 (이메일, 이름 동적 적용)
        user_data = {
            "id": 1,
            "email": email,
            "username": email.split("@")[0],
            "is_active": True,
            "is_admin": True,
            "authentik_id": "auth-admin-001",
            "avatar_url": None,
            "full_name": None,
            "phone": None,
            "created_at": "2026-02-10T19:38:27.467941",
            "updated_at": "2026-02-10T22:36:43.692191"
        }
        
        # 3. 페이지 로딩 전 로컬 스토리지 세팅 예약
        self.page.add_init_script(f"""
            window.localStorage.setItem('access_token', '{auth_data.get("access_token")}');
            window.localStorage.setItem('refresh_token', '{auth_data.get("refresh_token")}');
            window.localStorage.setItem('user', '{json.dumps(user_data)}');
        """)
</file>

</files>
